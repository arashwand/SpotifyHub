@model SportifyHub.Models.Coach
@using System.Text.Json;

@{
    ViewData["Title"] = Model?.Name ?? "جزئیات مربی"; // Handle model being null
    var qualificationsList = new List<string>();
    if (Model != null && !string.IsNullOrEmpty(Model.QualificationsJson)) {
        try { qualificationsList = JsonSerializer.Deserialize<List<string>>(Model.QualificationsJson) ?? new List<string>(); }
        catch { qualificationsList.Add("خطا در خواندن مدارک");}
    }
    var specialties = Model?.CoachSpecialties?.Select(cs => cs.Specialty.ToString()).ToList() ?? new List<string>();
    var reviews = Model?.Reviews?.ToList() ?? new List<Review>();
    // var classesTaught = Model?.FitnessClasses?.ToList() ?? new List<FitnessClass>(); // Assuming FitnessClasses is loaded if needed
}

<h1>@Html.DisplayFor(model => model.Name)</h1>

@if (Model == null)
{
    <p>اطلاعات مربی یافت نشد.</p>
    <a asp-action="Index" class="btn btn-secondary">بازگشت به لیست</a>
    return;
}

<p class="text-muted">@string.Join("، ", specialties) - @Model.ExperienceYears سال تجربه</p>

<div class="row">
    <div class="col-md-4">
        @if (!string.IsNullOrEmpty(Model.PhotoUrl))
        {
            <img src="@Url.Content(Model.PhotoUrl)" class="img-fluid rounded mb-3" alt="@Model.Name" style="max-height: 400px; object-fit: cover;">
        }
        else
        {
            <img src="~/images/placeholder-coach.png" class="img-fluid rounded mb-3" alt="تصویر موجود نیست" style="max-height: 400px; object-fit: cover;">
        }
        <p><strong>امتیاز:</strong> @Model.Rating / 5</p>
        @if(!string.IsNullOrEmpty(Model.ContactInfo))
        {
            <p><strong>اطلاعات تماس:</strong> @Model.ContactInfo</p>
        }
         <p><strong>مکان:</strong> @Model.Location</p>
    </div>
    <div class="col-md-8">
        <h4>بیوگرافی</h4>
        <p>@Html.Raw(Model.Bio?.Replace(Environment.NewLine, "<br />"))</p>

        @if (qualificationsList.Any())
        {
            <h4>مدارک و گواهینامه ها</h4>
            <ul>
                @foreach (var q in qualificationsList)
                {
                    <li>@q</li>
                }
            </ul>
        }

        @*<h4>کلاس های ارائه شده توسط این مربی</h4>
        @if (classesTaught.Any())
        {
            // TODO: Display classes taught
            <p>لیست کلاس ها...</p>
        }
        else
        {
            <p>کلاسی توسط این مربی ثبت نشده است.</p>
        }*@
    </div>
</div>

<hr />
<h4>نظرات کاربران</h4>
@if (reviews.Any())
{
    @foreach (var review in reviews)
    {
        <div class="card mb-2">
            <div class="card-body">
                <h6 class="card-title">@review.UserName <small class="text-muted">- @review.Rating ستاره</small></h6>
                <p class="card-text">@review.Comment</p>
                <small class="text-muted">تاریخ: @review.Date.ToString("yyyy/MM/dd")</small>
            </div>
        </div>
    }
}
else
{
    <p>هنوز نظری برای این مربی ثبت نشده است.</p>
}

<div class="mt-3">
    <a asp-action="Index" class="btn btn-secondary">بازگشت به لیست</a>
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">ویرایش</a>
</div>
